---
title: "Roster book `r params$group_name`"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output:
  pdf_document:
    latex_engine: xelatex
header-includes:
  - \usepackage{float}
classoption: landscape
---

```{r echo = FALSE}
library(bbrosterplots)
```


```{r logo, echo = FALSE, fig.align="center" ,  out.width = params$scale_cover_perc}

if (is.null(params$cover_image)){
  knitr::include_graphics(system.file("extdata", "default_cover.jpg", package = "bbrosterplots"))
} else{
  knitr::include_graphics(params$cover_image)
}
```

```{r preparation, include=FALSE}
# unpack parameters
group_name <- params$group_name
tournament_ruleset <- params$tournament_ruleset

if(is.null(params$races)){
  # use races from example data
  data(df_rosters)
  races <- sort(unique(df_rosters$roster.name))
} else {
  races <- params$races
}
```

```{r display, echo=FALSE, results='asis'}
esc <- function(x) gsub("%", "\\\\%", x)

out <- character(0)
for (race_name in races) {
  roster <- paste0(tournament_ruleset, "/", group_name, "_roster_plot_", race_name, ".png")
  out <- c(out, sprintf(
    "\\begin{figure}[H]\n\\centering\n\\includegraphics[width=1.2\\textwidth]{%s}\n\\caption{%s}\n\\end{figure}\n\\newpage\n",
    gsub(" ", "_", roster),
    esc(sprintf("%s %s – Roster overview.", stringr::str_replace_all(group_name, "_", " "), race_name))
  ))
  
  if (params$perc == TRUE){
  perc   <- paste0(tournament_ruleset, "/", group_name, "_percentage-stat_plot_", race_name, ".png")
    out <- c(out, sprintf(
      "\\begin{figure}[H]\n\\centering\n\\includegraphics[width=0.8\\textwidth]{%s}\n\\caption{%s}\n\\end{figure}\n\\newpage\n",
      gsub(" ", "_", perc),
      esc(sprintf(
        "%s %s – Percentage of skill pick by position. The chart displays the %% of players by position (type) which have a certain skill or no skill. If the total %% is above 100%%, it means some skill stacking is happening.",
        stringr::str_replace_all(group_name, "_", " "), race_name
      ))
    ))
  }
  if (params$team == TRUE){
    team   <- paste0(tournament_ruleset, "/", group_name, "_team-stat_plot_", race_name, ".png")
    out <- c(out, sprintf(
      "\\begin{figure}[H]\n\\centering\n\\includegraphics[width=0.8\\textwidth]{%s}\n\\caption{%s}\n\\end{figure}\n\\newpage\n",
      gsub(" ", "_", team),
      esc(sprintf(
        "%s %s – Distribution of team skills by position. The chart displays the average number of skills per position. The total should be equal to the maximum number of skills for the roster.",
        stringr::str_replace_all(group_name, "_", " "), race_name
        ))
    ))
  }
}
knitr::asis_output(out)
```
